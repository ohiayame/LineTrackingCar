# 🚗 미니 자율주행 자동차 프로젝트 

Jetson Nano 기반으로 라인트레이싱 자율주행 자동차를 제작한 프로젝트입니다. 카메라로 차선을 인식하여 DC 모터와 서보모터를 제어함으로써 트랙의 중간을 부드럽게 주행하도록 구현했습니다.

---

## 📌 프로젝트 개요

### 🎯 목표
- 카메라 입력을 통해 차선 인식
- 실시간 각도 및 속도 제어
- Jetson Nano와 모터 드라이버를 활용한 자율주행 자동차 개발

### ❗ 문제 정의
- 부정확한 차선 검출
- 각도 및 속도 조절의 어려움
- 실시간 주행 처리 지연

---

## ⚙ 기술 스택

### 🔩 하드웨어
| 구성 요소           | 설명 |
|--------------------|------|
| Jetson Nano        | NVIDIA AI 기반 임베디드 컴퓨터 |
| UPS 모듈           | 전원 안정화 |
| 웹캠               | 실시간 영상 입력 |
| 서보모터 (MG996R)  | 방향 조절 |
| DC 모터 (12V)      | 속도 제어 |
| 배터리팩 (11.1V)   | 전원 |
| 모터 드라이버 (L298N) | 모터 제어 및 전원 공급 |

### 💻 소프트웨어
| 기술        | 버전             |
|-------------|------------------|
| Python      | 3.6.9            |
| OpenCV      | 4.1.1            |
| Numpy       | 1.16.6           |
| PyTorch     | 1.10.0 (CUDA)    |
| TorchVision | 0.11.0a0+5eae32  |
| JetPack     | 4.6.1            |
| Jetson.GPIO | 2.0.17           |

---

## 🧱 시스템 구성

### 🚘 차량 구조
- 카메라는 위쪽에 기울여 설치 (넓은 시야 확보)
- 각도 제어: 서보모터 (0° ~ 180°)
- 속도 제어: DC 모터 (전진/후진 제어)
  
📷 실제 차량 사진  
<img src="assets/img/my_car.png" width="300"/>

### 📸 데이터 수집
- OpenCV로 실시간 프레임 촬영
- 각도별 폴더에 이미지 저장
- 초기: 버튼 기반 촬영 → 최종: 프레임 단위 자동 촬영

### ⚙ 전처리
- 이미지 크기: 640×480 → 상단 30% 자른 후 224×224 리사이즈
- 텐서 변환: `ToTensor()` (C, H, W) 형태로 변환
- 정규화: `Normalize(mean, std)` 사용 (범위: -0.5 ~ 0.5)
  
🖼 전처리 과정 예시  
<img src="assets/img/resizing.png" width="450"/>

---

## 🧠 딥러닝 모델

### ✅ CNN 구조
```text
Input → Conv → ReLU → Pooling → (반복) → FC → Output (각도 예측)
```
---

### 🧪 학습 조건
- **Epochs**: 30
- **Batch Size**: 32
- **Learning Rate**: 0.001
- **데이터셋 분할**: 학습용 70% / 검증용 30%
- **총 이미지 수**: 약 5,710장
  - 트랙을 한 방향으로 주행하며 수집했기 때문에 왼쪽·직진 데이터 비중이 큼
- **과적합 문제 발생**:
  - 초기에는 특정 방향 데이터에 치우쳐 학습 불균형 발생
  - `Normalize(mean, std)` 범위를 **[-0.5, 0.5]**로 조정해 해결
    
| 📊 처음 학습 결과 (과적합 발생) | 📊 전처리 후 재학습 결과 |
| --------------------- | ------------------- |
|  <img src="assets/img/loss_before.png" width="300"/>  |  <img src="assets/img/loss_after.png" width="300"/>  | 


---

## 🧪 성능 테스트 및 최적화

- **모델 성능 검증**:
  - 학습된 모델을 Jetson Nano에 배포하기 전 PC에서 테스트
  - 각도 예측 결과를 이미지 위에 화살표로 시각화하여 정밀 확인

- **Jetson Nano 실환경 테스트**:
  - 트랙 위에 차량을 놓고 실제 주행 성능 확인
  - 차량이 정지된 상태에서도 예측 값 수치 모니터링 가능

- **병렬 처리**:
  - `Thread`를 활용해 **촬영 스레드**와 **차량 제어 스레드**를 분리
  - 작업 간 대기 시간 최소화로 실시간성 확보

📊차선 각도에 따라 모델이 예측한 결과를 시각화한 이미지입니다.
<img src="assets/img/arrow_prediction.png" width="800"/>

---

## 💡 프로젝트 중 겪은 어려움과 극복 전략

| 어려움                             | 해결 방법 |
|------------------------------------|-----------|
| 장비 배송 지연, Jetson 불량       | 일정 재조정 및 예비 장비 확보 |
| 촬영 방법의 비효율                | 프레임 기반 자동 촬영으로 변경 |
| 과적합 현상                       | 정규화 범위 재설정 및 데이터셋 재구성 |
| 환경 구축 난항 (라이브러리 충돌) | CUDA 호환 버전 명시, 가상환경 관리 |
| 하드웨어 전류 지식 부족           | 외부 회로 자료 학습 및 실습 병행 |

---

## 🚀 향후 개선 방향

- **장애물 감지 및 회피 기능 추가**
- **신호등 및 도로 표지판 인식**
- **야외 환경 대응 차선 검출 기능 강화**
- **빛, 그림자, 날씨 등 환경 변화에 강한 모델 설계**

---

